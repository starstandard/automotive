@startuml
skinparam Style strictuml

participant User
participant "AI Agent" as AI
participant "UCP Bridge" as Bridge
participant "Loyalty/CRM Context" as CRM

User -> AI: "I have a $20 loyalty coupon..."
note right of AI: OPTIMIZATION: Ask for phone/VIN
AI -> User: "Can I get your phone number to verify the coupon?"
User -> AI: "555-0199"

group Validation
    AI -> CRM: verify_loyalty(555-0199, "LOYALTY_20")
    CRM --> AI: { status: "VALID", customer_key: "C-442" }
end

group Service Request & Cost Impact
    AI -> Bridge: create_service_request(labor: "LOF", discount: 20.00)
    Bridge -> Bridge: Resolve PricePlan & Split
    Bridge --> AI: { total: 69.95, split_id: "DRAFT-001" }
end

AI -> User: "Applied! Your total for the F-150 oil change is $69.95. Should I book it?"
@enduml