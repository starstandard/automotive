@startuml

skinparam packageStyle rectangle
skinparam roundcorner 10
skinparam defaultFontName Arial
skinparam componentStyle rectangle

title Automotive Retail Domain Map (13 Bounded Contexts)

rectangle "External Systems" as External #E0E0E0

' --------------------------------------------------------------------------
' LEVEL 1: Identity and Core Reference
' --------------------------------------------------------------------------
package "1. Party & Identity Management" as PIM #DDDDFF {
    component "Party (AR)" as PartyAR
    component "Customer Profile (AR)" as CustomerAR
    component "Organization Profile (AR)" as OrgAR
    component "Dealer Profile (AR)" as DealerAR
    component "Customer Information (AR)" as CustomerInfoAR 
    component "Dealer Locator (AR)" as DealerLocatorAR  
    component "Dealer Locator Extended (AR)" as DealerLocatorExtAR  
}
note bottom of PIM
    Source of Truth for all Identities:
    Staff, Customer, Vendor, Organization, Dealer
end note

 

' --------------------------------------------------------------------------
' LEVEL 2: Core Assets and Operations
' --------------------------------------------------------------------------
package "2. Inventory & Vehicle Management" as IVM #FFFFAA {
    component "Vehicle (AR)" as VehicleAR
    component "Warehouse" as Warehouse
    component "Standards" as Standards
    component "Vehicle Inventory (AR)" as VehicleInventoryAR  
    component "Vehicle Order (AR)" as VehicleOrderAR  
    component "Vehicle Specifications (AR)" as VehicleSpecsAR  
    component "Model Codes (AR)" as ModelCodesAR  
    component "Standard Codes (AR)" as StandardCodesAR  
}

package "3. Sales & Dealership Operations" as SDO #FFDDAA {
    component "Deal (AR)" as DealAR
    component "Purchase Order (AR)" as POAR
    component "Staff (AR)" as StaffAR
    component "Vendor" as Vendor
    component "Sales Lead (AR)" as SalesLeadAR  
    component "Retail Delivery Reporting (AR)" as RDRAR  
}

package "4. Service and Repair" as SRP #AAFFDD {
   component "Service Order (AR)" as SORepairAR

       component "Repair Order (AR)" as RepairOrderAR
       component "Service Advisory/Receipt Ack. (AR)" as ServiceAdvisoryAR
       component "Service Appointment (AR)" as ServiceAppointmentAR
       component "Service Appointment Ack. (AR)" as ServiceAppointmentAckAR
       component "Service Plan (AR)" as ServicePlanAR
       component "Service Processing Advisory (AR)" as ServiceProcessAdvAR
       component "Vehicle Service History (AR)" as VehicleServiceHistoryAR
       component "Labor Operations (AR)" as LaborOperationsAR
       component "Monthly Workshop Report (AR)" as WorkshopReportAR
}




' --------------------------------------------------------------------------
' LEVEL 3: Financial, Fulfillment, and Support
' --------------------------------------------------------------------------
package "5a. Payments Context" as PAY #FFCCCC {
    component "CreditAuthorization (AR)" as CreditAuthAR
    component "Payment (AR)" as PaymentAR
    component "PaymentMethod (AR)" as PaymentMethodAR
    component "CreditDecision (AR)" as CreditDecisionAR
    component "CreditContract (AR)" as CreditContractAR
    component "PaymentEvent" as PaymentEvent
            component "Payroll Payment (AR)" as PayrollPaymentAR
}
note bottom of PAY
    Agentic execution of money movement.
    Manages Authorization holds, Gateway
    integrations, and Transaction retries.
end note

package "5b. Finance & Accounting Context" as FIN #FF9999 {
    component "Invoice (AR)" as InvoiceAR
    component "JournalEntry (AR)" as JournalEntryAR
    component "ControlAccount" as ControlAccount
        component "Receipt (AR)" as ReceiptAR
    component "FinancialStatement (AR)" as FinancialStatementAR
    component "AccountingPeriod (AR)" as AccountingPeriodAR
    component "FinancialForecast (AR)" as FinancialForecastAR
}
note bottom of FIN
    The System of Record.
    Handles Tax, Ledger, and
    Financial Reporting.
end note


package "6. Marketing & Loyalty" as MKT #FFCCFF {
    component "Marketing Campaign" as Campaign
    component "Vehicle e-Marketing (AR)" as VehicleEMarketingAR
}




' --------------------------------------------------------------------------
' LEVEL 4: Data & Common
' --------------------------------------------------------------------------

package "7. Core & Common Entities" as CORE #F0F0F0 {
    component "Enums & Types" as Types
    component "Geographic Boundary(AR)" as GeographicBoundaryAR
    component "Lifecycle Event(AR)" as LifecycleEventAR
    component "Large File (AR)" as LargeFileAR
    component "Money/Price" as MoneyPrice
    component "Effective Date" as EffectiveDate

    component "Identifier" as Identifier
    component "Textual Detail" as TextualDetail
    component "Unit of Measure" as UnitOfMeasure
}


package "8. Telematics & Vehicle Events" as TELE #FFEECC {
    component "Vehicle State" as State
    component "Vehicle Telematics (AR)" as VehicleTelematicsAR
    component "Vehicle Data Availability (AR)" as VehicleDataAvailabilityAR
}

package "9. Warranty & Insurance" as WARR #CCCCFF {
    component "Warranty Claim" as Claim
}

package "10. Logistics & Fulfillment" as LOG #CCFFFF {
    component "Shipment (AR)" as ShipmentAR
    component "Vehicle Transfer Order (AR)" as TransferAR
    component "Parts Shipment (AR)" as PartsShipmentAR
}


package "11. Incentives & Programs" as INPR #CCFFCC {
    component "Incentive Rules" as Incentives
    component "Program Registry" as Programs
    component "Incentive Inquiry (AR)" as IncentiveInquiryAR
    component "Incentive Modification (AR)" as IncentiveModificationAR
    component "Initiative Download (AR)" as InitiativeDownloadAR
    component "Initiative Download Retrieval (AR)" as InitiativeDownloadRetrievalAR
    component "Vehicle Initiative Payment Invoice (AR)" as VehicleInitiativeInvoiceAR
    component "Vehicle Initiatives (AR)" as VehicleInitiativesAR
}


package "12. Human Resources" as HR #FFDD99 {
    component "Personnel Record (AR)" as PersonnelAR
    component "Time & Attendance" as TimeAR
    component "Staff Member (AR)" as StaffMemberAR
    component "Payroll Cycle (AR)" as PayrollCycleAR
    component "Payroll Run (AR)" as PayrollRunAR
    component "Payroll Stub (AR)" as PayrollStubAR
}


package "13. Subscription Management" as SUB #AAFFFF {
    component "Subscription Plan" as Plan
    component "Subscription Agreement (AR)" as SubscriptionAR
    component "Subscription Service (AR)" as SubscriptionServiceAR
    component "Price Plan (AR)" as PricePlanAR

}


package "14. Parts" as PARTS #FFEECC {
   component "Service Order (AR)" as SORepairAR
       component "Part (AR)" as PartAR
       component "Parts Activity (AR)" as PartsActivityAR
       component "Parts Delivery Details (AR)" as PartsDeliveryDetailsAR
       component "Parts Disposition (AR)" as PartsDispositionAR
       component "Part Inventory (AR)" as PartInventoryAR
       component "Parts Locator (AR)" as PartsLocatorAR
       component "Parts Master (AR)" as PartsMasterAR
       component "Parts Order (AR)" as PartsOrderAR
       component "Parts Pick List (AR)" as PartsPickListAR
       component "Part Search Criteria (AR)" as PartSearchCriteriaAR
       component "Parts Price List (AR)" as PartsPriceListAR
       component "Parts Return (AR)" as PartsReturnAR
       component "Price List (AR)" as PriceListAR
}

' --------------------------------------------------------------------------
' DEPENDENCIES (The Context Map)
' --------------------------------------------------------------------------

' 1. Identity is Core Reference
DealAR .up.> PartyAR : references Customer ID
POAR .up.> OrgAR : references Vendor Org ID
InvoiceAR .up.> PartyAR : references Customer/Vendor ID
StaffAR .up.> PartyAR : inherits identity
DealAR .up.> DealerAR : references Selling Dealer
CreditApplicationAR .up.> CustomerAR : links to applicant

' 2. Sales and Service need Vehicles
DealAR .left.> VehicleAR : needs Vehicle Specs
SORepairAR .left.> VehicleAR : needs Service History

' 3. Sales creates Financial and Logistics requests
DealAR --> InvoiceAR : creates Invoice
DealAR --> TransferAR : requests Vehicle Transfer
DealAR --> Incentives : applies rules

' 4. Service needs parts from Inventory/Logistics
SORepairAR .left.> PartAR : references needed parts
SORepairAR --> PartInventoryAR : references stock
SORepairAR --> ShipmentAR : requests Part Shipment
PartsOrderAR --> PartsShipmentAR : creates shipment request

' 5. Logistics needs Inventory data
TransferAR .left.> VehicleAR : specifies Vehicle to move

' Sales to Payments
DealAR --> CreditAuthAR : requests Authorization
CreditAuthAR --> PaymentAR : initiates Capture upon success

' Payments to Finance
PaymentEvent --> InvoiceAR : triggers payment reconciliation
PaymentAR --> JournalEntryAR : generates transaction record

' References
CreditAuthAR .up.> CustomerAR : references applicant
PaymentAR .up.> PaymentMethodAR : uses stored method

' 6. Marketing and Warranty need Customer data
Campaign .left.> CustomerAR : targets customers
Claim .left.> CustomerAR : validates claim owner

' 7. Telematics and Service
SORepairAR .down.> State : references diagnostic data

' 8. Subscriptions need Customer and Financial data
SubscriptionAR .up.> CustomerAR : manages contract for
SubscriptionAR --> InvoiceAR : creates recurring bill

' 9. HR needs Staff data
PersonnelAR .left.> StaffAR : manages staff record
PayrollCycleAR .up.> StaffMemberAR : links to personnel data
PayrollCycleAR --> PayrollPaymentAR : generates payment instruction(SETUP)
PayrollCycleAR .down.> PayrollRunAR : initiates
PayrollRunAR .down.> PayrollStubAR : generates pay details
PayrollRunAR .up.> StaffMemberAR : references employee data
PayrollRunAR .left.> TimeAR : calculates based on attendance

' 10. Programs reference Customers and Vehicles
Programs .left.> CustomerAR
Programs .left.> VehicleAR

' 11. Financial Ledger tracks all transactions
InvoiceAR --> JournalEntryAR : generates transaction
PayrollPaymentAR --> JournalEntryAR : generates transaction
JournalEntryAR .up.> ControlAccount : references accounts
' HR to FIN (Re-routed Relationship)
PayrollRunAR --> PayrollPaymentAR : generates payment instruction(ACTUAL)
PartyAR .down.> PaymentMethodAR : references payment methods
JournalEntryAR --> AccountingPeriodAR : references an accounting period




' NEW PAYMENT FLOWS
PaymentAR .up.> PaymentMethodAR : uses Payment Method AR
PaymentAR --> External : communicates with Gateway
PaymentAR --> PaymentEvent : **emits Status Change**
PaymentEvent --> InvoiceAR : informs of Payment Success/Failure
PaymentEvent --> PayrollPaymentAR : informs of Payroll Success/Failure
@enduml